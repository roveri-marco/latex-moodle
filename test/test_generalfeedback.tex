% !TeX encoding = UTF-8
% !TeX spellcheck = en_US
\documentclass{article}

\usepackage{../moodle,ifxetex}
%\usepackage{../moodlev5,ifxetex}

\ifxetex % FOR XELATEX
	\usepackage{fontspec}
\else %% FOR PDFLATEX
	\usepackage[utf8]{inputenc} % necessary
	\usepackage[T1]{fontenc} % necessary
\fi

\usepackage[french]{babel} % for french quotes

\begin{document}

\section*{Introduction}

This document demonstrates a weird compilation bug when using characters like 
\verb|\oe, \ae, \og, \fg, \aa| (and capitalized version) and defining general 
feedback (quizz-level or question-level). Using pdf\LaTeX\ the compilation 
hangs at the recursion level of conversion to HTML 
(\verb|\long\def\htmlize@recursive@i|), while it compiles fine with xe\LaTeX.

This is a regression bug introduced in version \texttt{0.6}. Using package as 
of version \texttt{0.5} results in fine compilation (although some characters 
may not be well transcribed in the XML).

\begin{quiz}[points=1]{General Feedback Test}

\begin{multi}[feedback={multi}]{Title}
%\og abc\fg%\ae%\oe%
\AA
\item[feedback={tic}] \ae
\item[feedback={tac}]* \oe
\end{multi}

\begin{shortanswer}[feedback={shortanswer}]{Title}
%	%\og abc\fg%\ae%\oe
\AA
\item[feedback={toc}] B
\item[feedback={\og\fg}] C
\item[fraction=0] *
\end{shortanswer}

\begin{numerical}[feedback={numerical}]{Title}
%	%\og abc\fg%\ae%\oe
\AA
\item[feedback={toc}] 1
\item[feedback={\og\fg}] 2
\item[fraction=0] 3
\end{numerical}

\begin{matching}[feedback={matching}]{Title}
%\og abc\fg%\ae%\oe%
\AA
\item \ae \answer oui
\item \oe \answer non
\item \answer \AA
\end{matching}

\begin{essay}[feedback={essay}]{Title}
%\og abc\fg%\ae%\oe%
\AA
\item \ae yo
\item \oe
\end{essay}

\begin{cloze}[feedback={54}]{Cloze}
\AA
\begin{multi}[shuffle=false]
\OE
\item[]* chip
\item[feedback={yes},fraction=10] chop
\item[feedback={no.}] chap
\end{multi}
\fg
\begin{shortanswer}
\AA
\item[feedback={toc}] B
\item[feedback={\og\fg}] C
\item[fraction=0] *
\end{shortanswer}
\og
\begin{numerical}
\AA
\item[] 1
\item[feedback={\og\fg}] 2
\item[fraction=0] 3
\end{numerical}
\begin{multi}[shuffle=false,vertical]
\OE
\item[feedback={yes}]* chip
\item[fraction=10] chop
\item[feedback={no.}] chap
\end{multi}

\begin{multi}[shuffle=false,horizontal]
\OE
\item[feedback={yes}]* chip
\item[fraction=10] chop
\item[feedback={no.}] chap
\end{multi}

\end{cloze}

\end{quiz}

\end{document}
